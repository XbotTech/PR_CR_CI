name: PR Notify to Feishu

on:
  pull_request:
    types: [opened, closed, reopened]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send message to Feishu
        env:
          FEISHU_WEBHOOK_URL: ${{ secrets.FEISHU_WEBHOOK_URL }}
        run: |
          ACTION="${{ github.event.action }}"
          TITLE="${{ github.event.pull_request.title }}"
          AUTHOR="${{ github.event.pull_request.user.login }}"
          URL="${{ github.event.pull_request.html_url }}"
          REPO="${{ github.repository }}"

          if [[ "$ACTION" == "closed" && "${{ github.event.pull_request.merged }}" == "true" ]]; then
            ACTION_TEXT="âœ… PR å·²åˆå¹¶"
          elif [[ "$ACTION" == "closed" ]]; then
            ACTION_TEXT="âŒ PR å·²å…³é—­"
          elif [[ "$ACTION" == "opened" ]]; then
            ACTION_TEXT="ğŸ†• PR å·²åˆ›å»º"
          else
            ACTION_TEXT="â„¹ï¸ PR æ›´æ–°"
          fi

          curl -X POST "$FEISHU_WEBHOOK_URL" \
            -H "Content-Type: application/json" \
            -d "{
              \"msg_type\": \"text\",
              \"content\": {
                \"text\": \"$ACTION_TEXT\n\nğŸ“¦ ä»“åº“: $REPO\nğŸ‘¤ å‘èµ·äºº: $AUTHOR\nğŸ“„ æ ‡é¢˜: $TITLE\nğŸ”— é“¾æ¥: $URL\"
              }
            }"
